# Test info

- Name: API Login Tests >> API login + UI verification
- Location: M:\PlaywrightStuff\src\tests\apiLogin.test.ts:32:7

# Error details

```
Error: expect(locator).toBeVisible()

Locator: locator('a[href="#create"]')
Expected: visible
Received: <element(s) not found>
Call log:
  - expect.toBeVisible with timeout 5000ms
  - waiting for locator('a[href="#create"]')

    at M:\PlaywrightStuff\src\tests\apiLogin.test.ts:50:44
```

# Test source

```ts
   1 | import { test, expect } from '../fixtures';
   2 | import dotenv from 'dotenv';
   3 | import path from 'path';
   4 |
   5 | // Загружаем переменные окружения из .env файла
   6 | dotenv.config({ path: path.join(__dirname, '../.env') });
   7 |
   8 | test.describe('API Login Tests', () => {
   9 |   test('Successful login with valid credentials', async ({ loginPage }) => {
  10 |     // Получаем credentials из .env
  11 |     const username = process.env.CM_USERNAME;
  12 |     const password = process.env.CM_PASSWORD;
  13 |
  14 |     if (!username || !password) {
  15 |       throw new Error('CM_USERNAME or CM_PASSWORD not defined in .env file');
  16 |     }
  17 |
  18 |     // Выполняем API запрос
  19 |     const response = await loginPage.apiLogin(username, password);
  20 |     
  21 |     // Проверяем структуру ответа
  22 |     expect(response).toEqual({
  23 |       status: "SUCCESS",
  24 |       data: expect.any(String)
  25 |     });
  26 |     
  27 |     // Проверяем конкретные значения
  28 |     expect(response.status).toBe("SUCCESS");
  29 |     expect(response.data).toBe("vlad");
  30 |   });
  31 |
  32 |   test('API login + UI verification', async ({ loginPage, dashboardPage }) => {
  33 |   // 1. Берём credentials из .env
  34 |   const username = process.env.CM_USERNAME;
  35 |   const password = process.env.CM_PASSWORD;
  36 |   
  37 |   if (!username || !password) {
  38 |     throw new Error('Add CM_USERNAME and CM_PASSWORD to .env');
  39 |   }
  40 |
  41 |   // 2. Делаем API-логин (получаем имя пользователя)
  42 |   const response = await loginPage.apiLogin(username, password);
  43 |   expect(response.status).toBe("SUCCESS");
  44 |   expect(response.data).toBe("vlad"); // Проверяем, что сервер узнал пользователя
  45 |
  46 |   // 3. Переходим на UI (сессия должна быть создана автоматически)
  47 |   await loginPage.navigateToLogin();
  48 |
  49 |   // 4. Проверяем авторизацию через UI элементы
> 50 |   await expect(dashboardPage.createButton).toBeVisible();
     |                                            ^ Error: expect(locator).toBeVisible()
  51 |   
  52 |   // Дополнительно: проверяем отображение имени пользователя (если есть)
  53 |   /*const userProfileName = loginPage.page.locator('.user-profile-name');
  54 |   if (await userProfileName.isVisible()) {
  55 |     await expect(userProfileName).toHaveText(response.data); // "vlad"
  56 |   } */
  57 | });
  58 | });
```