# Test info

- Name: API Login Tests >> API login + UI verification
- Location: M:\PlaywrightStuff\src\tests\apiLogin.test.ts:32:7

# Error details

```
Error: expect(received).toBeTruthy()

Received: false
    at M:\PlaywrightStuff\src\tests\apiLogin.test.ts:41:57
```

# Test source

```ts
   1 | import { test, expect } from '../fixtures';
   2 | import dotenv from 'dotenv';
   3 | import path from 'path';
   4 |
   5 | // Загружаем переменные окружения из .env файла
   6 | dotenv.config({ path: path.join(__dirname, '../.env') });
   7 |
   8 | test.describe('API Login Tests', () => {
   9 |   test('Successful login with valid credentials', async ({ loginPage }) => {
  10 |     // Получаем credentials из .env
  11 |     const username = process.env.CM_USERNAME;
  12 |     const password = process.env.CM_PASSWORD;
  13 |
  14 |     if (!username || !password) {
  15 |       throw new Error('CM_USERNAME or CM_PASSWORD not defined in .env file');
  16 |     }
  17 |
  18 |     // Выполняем API запрос
  19 |     const response = await loginPage.apiLogin(username, password);
  20 |     
  21 |     // Проверяем структуру ответа
  22 |     expect(response).toEqual({
  23 |       status: "SUCCESS",
  24 |       data: expect.any(String)
  25 |     });
  26 |     
  27 |     // Проверяем конкретные значения
  28 |     expect(response.status).toBe("SUCCESS");
  29 |     expect(response.data).toBe("vlad");
  30 |   });
  31 |
  32 |   test('API login + UI verification', async ({ loginPage, dashboardPage, page }) => {
  33 |   // 1. API-логин (создаёт сессию)
  34 |   const { data: username } = await loginPage.apiLogin(
  35 |     process.env.CM_USERNAME!, 
  36 |     process.env.CM_PASSWORD!
  37 |   );
  38 |
  39 |   // 2. Проверяем куки (для отладки)
  40 |   const cookies = await page.context().cookies();
> 41 |   expect(cookies.some(c => c.name.includes('session'))).toBeTruthy();
     |                                                         ^ Error: expect(received).toBeTruthy()
  42 |
  43 |   // 3. Переходим на UI (с теми же куки)
  44 |   await loginPage.navigateToLogin();
  45 |
  46 |   // 4. Проверяем авторизацию
  47 |   await expect(dashboardPage.createButton).toBeVisible();
  48 |   
  49 |   // 5. Доп. проверка: имя пользователя в интерфейсе
  50 |   await expect(page.locator('top-toolbar__profile-username')).toHaveText(username);
  51 | });
  52 | });
```